{
  "version": "2.0.0",
  "tasks": [
    /* ======================
       ğŸš€ SERVIDOR Y QA
       ====================== */
    {
      "label": "ğŸš€ Iniciar servidor PHP (8080)",
      "type": "shell",
      "command": "php",
      "args": ["-S", "localhost:8080", "-t", "public"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "ğŸ§ª Ejecutar Tests PHPUnit",
      "type": "shell",
      "command": "vendor/bin/phpunit",
      "args": ["--colors=always", "--testdox"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "ğŸ” Analizar cÃ³digo (PHPStan)",
      "type": "shell",
      "command": "vendor/bin/phpstan",
      "args": ["analyse", "--memory-limit=1G"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "âš™ï¸ Validar composer",
      "type": "shell",
      "command": "composer",
      "args": ["validate"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "ğŸ§ª QA completo (tests + phpstan + composer)",
      "dependsOn": [
        "ğŸ§ª Ejecutar Tests PHPUnit",
        "ğŸ” Analizar cÃ³digo (PHPStan)",
        "âš™ï¸ Validar composer"
      ],
      "dependsOrder": "sequence",
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },

    /* ======================
       ğŸ” TAREAS GIT SEGURAS
       ====================== */
    {
      "label": "ğŸ§¹ Git: mostrar estado",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "echo 'ğŸ“¦ Rama actual:' $(git rev-parse --abbrev-ref HEAD); git status -sb"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "ğŸ“¸ Git: commit rÃ¡pido (si hay cambios)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "if ! git diff --quiet || ! git diff --cached --quiet; then git add -A && git commit -m 'commit rÃ¡pido desde VS Code'; else echo 'ğŸ”¹ No hay cambios para commitear'; fi"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "â¬†ï¸ Git: push seguro (rama actual)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "branch=$(git rev-parse --abbrev-ref HEAD); if ! git diff --quiet || ! git diff --cached --quiet; then git add -A && git commit -m 'sync desde local'; fi; git push origin \"$branch\""
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "â¬‡ï¸ Git: pull seguro (rebase)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "branch=$(git rev-parse --abbrev-ref HEAD); git pull --rebase origin \"$branch\""
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },

    /* ======================
       ğŸŒ¿ GESTIÃ“N DE RAMAS
       ====================== */
    {
      "label": "ğŸŒ¿ Git: mostrar ramas",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "git branch -vv"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "ğŸŒ± Git: crear nueva rama",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "read -p 'Nombre de la nueva rama: ' branch; git checkout -b $branch"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "ğŸ’€ Git: reset duro a remoto (descartar todo local)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "branch=$(git rev-parse --abbrev-ref HEAD); git fetch origin && git reset --hard origin/$branch"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "ğŸ§¹ Git: limpiar archivos sin seguimiento",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "git clean -fd && git status"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "ğŸ·ï¸ Git: crear tag (versiÃ³n)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "read -p 'Nombre del tag: ' tag; git tag -a $tag -m 'VersiÃ³n $tag' && git push origin $tag"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },

    /* ======================
       ğŸ’£ TAREAS GIT AVANZADAS
       ====================== */
    {
      "label": "ğŸ§¨ Git: subir TODO y pisar remoto (FORCE)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "git add -A && git commit -m \"subida limpia desde local\" || true; git push --force origin main"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },

    /* ======================
       ğŸŸ£ SERVICIOS LOCALES
       ====================== */
    {
      "label": "ğŸ¤– Run OpenAI Service (8081)",
      "type": "shell",
      "command": "php",
      "args": ["-S", "localhost:8081", "-t", "public"],
      "options": { "cwd": "${workspaceFolder}/openai-service" },
      "isBackground": true,
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "ğŸ§¬ Run RAG Service (8082)",
      "type": "shell",
      "command": "php",
      "args": ["-S", "localhost:8082", "-t", "public"],
      "options": { "cwd": "${workspaceFolder}/rag-service" },
      "isBackground": true,
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "ğŸš€ Run All Services (8080 + 8081 + 8082)",
      "dependsOn": [
        "ğŸš€ Iniciar servidor PHP (8080)",
        "ğŸ¤– Run OpenAI Service (8081)",
        "ğŸ§¬ Run RAG Service (8082)"
      ],
      "dependsOrder": "parallel",
      "presentation": { "reveal": "always", "panel": "shared" },
      "group": { "kind": "build", "isDefault": true }
    },

    /* ======================
       ğŸ¤– CLI CODEX
       ====================== */
    {
      "label": "ğŸ¤– Abrir CLI Codex (agent.md)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "codex agent.md"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared", "focus": true },
      "problemMatcher": []
    }
  ]
}
