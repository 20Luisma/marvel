{
  "version": "2.0.0",
  "tasks": [
    {
      "label": "üöÄ Iniciar servidor PHP (8080)",
      "type": "shell",
      "command": "php",
      "args": ["-S", "localhost:8080", "-t", "public"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "üß™ Ejecutar Tests PHPUnit",
      "type": "shell",
      "command": "vendor/bin/phpunit",
      "args": ["--colors=always", "--testdox"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "üîç Analizar c√≥digo (PHPStan)",
      "type": "shell",
      "command": "vendor/bin/phpstan",
      "args": ["analyse", "--memory-limit=1G"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "‚öôÔ∏è Validar composer",
      "type": "shell",
      "command": "composer",
      "args": ["validate"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "üß™ QA completo (tests + phpstan + composer)",
      "dependsOn": [
        "üß™ Ejecutar Tests PHPUnit",
        "üîç Analizar c√≥digo (PHPStan)",
        "‚öôÔ∏è Validar composer"
      ],
      "dependsOrder": "sequence",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },

    /* ======================
       üîê TAREAS GIT SEGURAS
       ====================== */

    {
      "label": "üì∏ Git: commit r√°pido (si hay cambios)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "if ! git diff --quiet || ! git diff --cached --quiet; then git add -A && git commit -m \"commit r√°pido desde VS Code\"; else echo \"üîπ No hay cambios para commitear\"; fi"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "‚¨ÜÔ∏è Git: push seguro (rama actual)",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "branch=$(git rev-parse --abbrev-ref HEAD); if ! git diff --quiet || ! git diff --cached --quiet; then git add -A && git commit -m \"sync desde local\"; fi; git push origin \"$branch\""
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "üßπ Git: mostrar estado antes de tocar nada",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "echo \"üì¶ Rama actual:\" $(git rev-parse --abbrev-ref HEAD); echo \"üìÑ Estado:\"; git status -sb"
      ],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },

    /* ======================
       üü£ SERVICIOS LOCALES
       ====================== */

    {
      "label": "ü§ñ Run OpenAI Service (8081)",
      "type": "shell",
      "command": "php",
      "args": ["-S", "localhost:8081", "-t", "public"],
      "options": {
        "cwd": "${workspaceFolder}/openai-service"
      },
      "isBackground": true,
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "üß¨ Run RAG Service (8082)",
      "type": "shell",
      "command": "php",
      "args": ["-S", "localhost:8082", "-t", "public"],
      "options": {
        "cwd": "${workspaceFolder}/rag-service"
      },
      "isBackground": true,
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "problemMatcher": []
    },
    {
      "label": "üöÄ Run All Services (8080 + 8081 + 8082)",
      "dependsOn": [
        "üöÄ Iniciar servidor PHP (8080)",
        "ü§ñ Run OpenAI Service (8081)",
        "üß¨ Run RAG Service (8082)"
      ],
      "dependsOrder": "parallel",
      "presentation": {
        "reveal": "always",
        "panel": "shared"
      },
      "group": {
        "kind": "build",
        "isDefault": true
      }
    },

    /* ======================
       ü§ñ CLI CODEX
       ====================== */
    {
      "label": "ü§ñ Abrir CLI Codex (agent.md)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "codex agent.md"],
      "options": {
        "cwd": "${workspaceFolder}"
      },
      "presentation": {
        "reveal": "always",
        "panel": "shared",
        "focus": true
      },
      "problemMatcher": []
    }

    /*
    ======================
    ‚ö†Ô∏è TAREAS PELIGROSAS (DESACTIVADAS)
    Las dejo aqu√≠ comentadas por si alg√∫n d√≠a quieres usarlas,
    pero as√≠ no las puedes ejecutar por accidente.
    ======================

    {
      "label": "üí£ Git: vaciar remoto (DEJAR GITHUB EN BLANCO)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "echo '‚ö†Ô∏è Esta tarea est√° desactivada en la versi√≥n segura'"]
    },
    {
      "label": "üì¶ Git: subir TODO el proyecto (FORCE a main)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "echo '‚ö†Ô∏è Esta tarea hac√≠a --force. Rev√≠sa antes de usar.'"]
    },
    {
      "label": "üß® Git: sobrescribir remoto con mi local (FORCE)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "echo '‚ö†Ô∏è Esta tarea hac√≠a push --force. Desactivada.'"]
    }
    */
  ]
}
