{
  "version": "2.0.0",
  "inputs": [
    {
      "id": "nuevaRama",
      "type": "promptString",
      "description": "Nombre de la nueva rama",
      "default": "feature/nueva-rama"
    },
    {
      "id": "nuevoTag",
      "type": "promptString",
      "description": "Nombre del tag (v1.0.0)",
      "default": "v1.0.0"
    }
  ],
  "tasks": [
    /* ======================
       üöÄ SERVIDOR Y QA
       ====================== */
    {
      "label": "üöÄ Iniciar servidor PHP (8080)",
      "type": "shell",
      "command": "php",
      "args": ["-S", "localhost:8080", "-t", "public"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "üß™ Ejecutar Tests PHPUnit",
      "type": "shell",
      "command": "vendor/bin/phpunit",
      "args": ["--colors=always", "--testdox"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "üîç Analizar c√≥digo (PHPStan)",
      "type": "shell",
      "command": "vendor/bin/phpstan",
      "args": ["analyse", "--memory-limit=1G"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "‚öôÔ∏è Validar composer",
      "type": "shell",
      "command": "composer",
      "args": ["validate"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "üß™ QA completo (tests + phpstan + composer)",
      "dependsOn": [
        "üß™ Ejecutar Tests PHPUnit",
        "üîç Analizar c√≥digo (PHPStan)",
        "‚öôÔ∏è Validar composer"
      ],
      "dependsOrder": "sequence",
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },

    /* ======================
       üîê TAREAS GIT SEGURAS
       ====================== */
    {
      "label": "üßπ Git: mostrar estado // SEGURO",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "echo 'üì¶ Rama actual:' $(git rev-parse --abbrev-ref HEAD); git status -sb"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "üì∏ Git: commit r√°pido (si hay cambios) // SEGURO",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "if ! git diff --quiet || ! git diff --cached --quiet; then git add -A && git commit -m \"commit r√°pido desde VS Code\"; else echo \"üîπ No hay cambios para commitear\"; fi"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "‚¨ÜÔ∏è Git: push seguro (rama actual) // SEGURO",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "branch=$(git rev-parse --abbrev-ref HEAD); if ! git diff --quiet || ! git diff --cached --quiet; then git add -A && git commit -m \"sync desde local\"; fi; git push origin \"$branch\""
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "‚¨áÔ∏è Git: pull seguro (rebase) // SEGURO",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "branch=$(git rev-parse --abbrev-ref HEAD); git pull --rebase origin \"$branch\""
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },

    /* ======================
       üåø GESTI√ìN DE RAMAS
       ====================== */
    {
      "label": "üåø Git: mostrar ramas // SEGURO",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "git branch -vv"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "üå± Git: crear nueva rama // SEGURO",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "git checkout -b \"${input:nuevaRama}\""],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "üßπ Git: limpiar archivos sin seguimiento // CUIDADO (solo borra archivos fuera de Git)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "git clean -fd && git status"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "üè∑Ô∏è Git: crear tag (versi√≥n) // SEGURO",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "git tag -a \"${input:nuevoTag}\" -m \"Versi√≥n ${input:nuevoTag}\" && git push origin \"${input:nuevoTag}\""
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },

    /* ======================
       üí£ TAREA GIT AVANZADA
       ====================== */
    {
      "label": "üß® Git: subir TODO y pisar remoto (FORCE) // ‚ö†Ô∏è PELIGROSO: reemplaza GitHub con lo local",
      "type": "shell",
      "command": "bash",
      "args": [
        "-c",
        "git add -A && git commit -m \"subida limpia desde local\" || true; git push --force origin main"
      ],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },

    /* ======================
       üü£ SERVICIOS LOCALES
       ====================== */
    {
      "label": "ü§ñ Run OpenAI Service (8081)",
      "type": "shell",
      "command": "php",
      "args": ["-S", "localhost:8081", "-t", "public"],
      "options": { "cwd": "${workspaceFolder}/openai-service" },
      "isBackground": true,
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "üß¨ Run RAG Service (8082)",
      "type": "shell",
      "command": "php",
      "args": ["-S", "localhost:8082", "-t", "public"],
      "options": { "cwd": "${workspaceFolder}/rag-service" },
      "isBackground": true,
      "presentation": { "reveal": "always", "panel": "shared" },
      "problemMatcher": []
    },
    {
      "label": "üöÄ Run All Services (8080 + 8081 + 8082)",
      "dependsOn": [
        "üöÄ Iniciar servidor PHP (8080)",
        "ü§ñ Run OpenAI Service (8081)",
        "üß¨ Run RAG Service (8082)"
      ],
      "dependsOrder": "parallel",
      "presentation": { "reveal": "always", "panel": "shared" },
      "group": { "kind": "build", "isDefault": true }
    },

    /* ======================
       ü§ñ CLI CODEX
       ====================== */
    {
      "label": "ü§ñ Abrir CLI Codex (agent.md)",
      "type": "shell",
      "command": "bash",
      "args": ["-c", "codex agent.md"],
      "options": { "cwd": "${workspaceFolder}" },
      "presentation": { "reveal": "always", "panel": "shared", "focus": true },
      "problemMatcher": []
    }
  ]
}
